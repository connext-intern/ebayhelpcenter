<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.connext.ebayhelpcenter.dao.ManagerDao">
    <resultMap id="ebayFirstMenus" type="com.connext.ebayhelpcenter.model.EbayFirstMenus">
        <id column="first_id" property="firstId"/>
        <result property="firstTitle" column="first_title"/>
        <result property="firstSerial" column="first_serial"/>
        <collection property="secondMenuses" ofType="com.connext.ebayhelpcenter.model.EbaySecondMenus">
            <id column="second_id" property="secondId" javaType="int" jdbcType="INTEGER"/>
            <result column="second_title" property="secondTitle" javaType="string" jdbcType="VARCHAR"/>
            <result column="second_serial" property="secondSerial" javaType="int" jdbcType="INTEGER"/>
            <result column="content" property="content" javaType="string" jdbcType="LONGVARCHAR"/>
            <result column="html" property="html" javaType="string" jdbcType="LONGVARCHAR"/>
            <result column="second_first_id" property="secondFirstId" javaType="int" jdbcType="INTEGER"/>
        </collection>
    </resultMap>
    <select id="queryAll" resultType="com.connext.ebayhelpcenter.model.EbayFirstMenus">
        SELECT first_title FROM ebay_first_menus
    </select>
    <select id="listAllTitle" resultMap="ebayFirstMenus">
        SELECT f.first_id,s.second_id,f.first_title,s.second_title
        FROM ebay_first_menus f left join ebay_second_menus s
        ON  f.first_id=s.second_first_id
        ORDER BY f.first_serial,s.second_serial
    </select>
    <select id="queryKeyWords" parameterType="String" resultType="com.connext.ebayhelpcenter.model.EbaySecondMenus">
        select second_title,content,second_id from ebay_second_menus where html like '%${value}%'
    </select>
    <select id="queryContent" resultType="com.connext.ebayhelpcenter.model.EbaySecondMenus">
        select second_title,content from ebay_second_menus where second_id=#{VALUE}
    </select>

    <!-- 查询是否存在该二级菜单 -->
    <select id="hasSecondMenu" resultType="boolean">
        <![CDATA[ SELECT count(*) FROM ebay_second_menus WHERE second_id = #{secondId} ]]>
    </select>

    <!-- 删除该二级菜单 -->
    <delete id="deleteSecondMenuInfo">
        DELETE FROM ebay_second_menus WHERE second_id = #{secondId}
    </delete>

    <!-- 查询一级菜单下是否存在二级菜单 -->
    <select id="firstHasSecondMenus" resultType="boolean">
        <![CDATA[ SELECT count(*) FROM ebay_second_menus WHERE second_first_id = #{firstId} ]]>
    </select>

    <!-- 删除一级菜单下的所有二级菜单信息 -->
    <delete id="deleteSecondMenusInfoFromFirst">
        DELETE FROM ebay_second_menus WHERE second_first_id = #{firstId}
    </delete>

    <!-- 删除一级菜单 -->
    <delete id="deleteFirstMenuInfo">
        DELETE from ebay_first_menus WHERE first_id = #{firstId}
    </delete>

    <!--增加一级菜单-->
    <update id="newFirstMenus" parameterType="com.connext.ebayhelpcenter.model.EbayFirstMenus">
        INSERT INTO ebay_first_menus (first_serial,first_title)
        VALUES
        ((SELECT max_serial FROM
        (SELECT MAX(first_serial) AS max_serial FROM ebay_first_menus ) t2)+1,
        #{ebayFirstMenus.firstTitle});
    </update>

    <!--增加二级菜单及其内容-->
    <update id="newSecondMenus" parameterType="com.connext.ebayhelpcenter.model.EbaySecondMenus">
        INSERT INTO ebay_second_menus(second_serial,second_title,content,html,second_first_id)
        VALUES
        ((SELECT max_serial FROM
        (SELECT MAX(second_serial) AS max_serial FROM ebay_second_menus ) t2)+1,
        #{ebaySecondMenus.secondTitle},#{ebaySecondMenus.content},#{ebaySecondMenus.html},
        #{ebaySecondMenus.secondFirstId});
    </update>

    <!--新增二级菜单时判断一级菜单是否还存在-->
    <select id="hasFirstMenus" parameterType="int" resultType="boolean">
        <![CDATA[ SELECT count(*) FROM ebay_first_menus WHERE first_id = #{secondFirstId} ]]>
    </select>

</mapper>